<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> TypeScript Spec Version 1.8 - Classes · Shane Hsi Rocks</title><meta name="description" content="本身，JavaScript practice has two very common design patterns: the module pattern and the class pattern.
简单来说，Roughly speaking, the module pattern uses closures to hide names and to encapsulate private data, while the class pattern uses prototype chains to implement many variations on object-oriented inheritance mechanisms. 
module 模式是利用闭包。
class 模式用原型链来实现 OO 继承机制。

但是注意，EC2015 引入了 module 机制和 module pattern 实现的原理不同，为了防止混淆，在 TypeScript 中，module pattern 对应的是 namespace。

&lt;a href=&quot;https://github.com/Microsoft/TypeScript/blob/master/doc/sp"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">博客</a></li><li class="nav-list-item"><a href="https://github.com/shane13hsi" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">TypeScript Spec Version 1.8 - Classes</h1><div class="post-meta"><div class="post-time">Feb 26, 2016</div></div><div class="post-content"><p>本身，JavaScript practice has two very common design patterns: the module pattern and the class pattern.</p>
<p>简单来说，Roughly speaking, the module pattern uses closures to hide names and to encapsulate private data, while the class pattern uses prototype chains to implement many variations on object-oriented inheritance mechanisms. </p>
<p>module 模式是利用闭包。</p>
<p>class 模式用原型链来实现 OO 继承机制。</p>
<blockquote>
<p>但是注意，EC2015 引入了 module 机制和 module pattern 实现的原理不同，为了防止混淆，在 TypeScript 中，module pattern 对应的是 namespace。</p>
</blockquote>
<p><a href="https://github.com/Microsoft/TypeScript/blob/master/doc/spec.md#16-classes" target="_blank" rel="external">Classes</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BankAccount</span> </span>&#123;  </span><br><span class="line">    balance = <span class="number">0</span>;  </span><br><span class="line">    deposit(credit: number) &#123;  </span><br><span class="line">        <span class="keyword">this</span>.balance += credit;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.balance;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>生成的 JavaScript（TypeScript 的目标是生成 consistent，idiomatic 的 JavaScript 代码）：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> BankAccount = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">BankAccount</span>(<span class="params"></span>) </span>&#123;  </span><br><span class="line">        <span class="keyword">this</span>.balance = <span class="number">0</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    BankAccount.prototype.deposit = <span class="function"><span class="keyword">function</span>(<span class="params">credit</span>) </span>&#123;  </span><br><span class="line">        <span class="keyword">this</span>.balance += credit;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.balance;  </span><br><span class="line">    &#125;;  </span><br><span class="line">    <span class="keyword">return</span> BankAccount;  </span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>OK，回过头看 <code>class BankAccount</code>，它做了：</p>
<ul>
<li>creates a variable named ‘BankAccount’</li>
<li>whose value is the constructor function for ‘BankAccount’ instances.</li>
<li>also creates an instance type of the same name. </li>
</ul>
<p>关于 instance type，如果用接口可以这样写：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface BankAccount &#123;  </span><br><span class="line">    balance: number;  </span><br><span class="line">    deposit(credit: number): number;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If we were to write out the function type declaration for the ‘BankAccount’ constructor variable, it would have the following form.</p>
<p>即，这是关于第一点，BankAccount 的值是一个 constructor 函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> BankAccount: <span class="keyword">new</span>() =&gt; BankAccount;</span><br></pre></td></tr></table></figure>
<p>The function signature is prefixed with the keyword ‘new’ indicating that the ‘BankAccount’ function must be called as a constructor. It is possible for a function’s type to have both call and constructor signatures. For example, the type of the built-in JavaScript Date object includes both kinds of signatures.</p>
<p>在 constructor 里做些初始化：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BankAccount</span> </span>&#123;  </span><br><span class="line">    balance: number;  </span><br><span class="line">    constructor(initially: number) &#123;  </span><br><span class="line">        <span class="keyword">this</span>.balance = initially;  </span><br><span class="line">    &#125;  </span><br><span class="line">    deposit(credit: number) &#123;  </span><br><span class="line">        <span class="keyword">this</span>.balance += credit;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.balance;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>简化版本：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BankAccount</span> </span>&#123;  </span><br><span class="line">    constructor(public balance: number) &#123;  </span><br><span class="line">    &#125;  </span><br><span class="line">    deposit(credit: number) &#123;  </span><br><span class="line">        <span class="keyword">this</span>.balance += credit;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.balance;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The ‘public’ keyword denotes that the constructor parameter is to be retained as a field. </p>
<p>Public is the default accessibility for class members, but a programmer can also specify private or protected accessibility for a class member.</p>
<p>Section 8 provides additional information about classes.</p>
<p>继承。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CheckingAccount</span> <span class="keyword">extends</span> <span class="title">BankAccount</span> </span>&#123;  </span><br><span class="line">    constructor(balance: number) &#123;  </span><br><span class="line">        <span class="keyword">super</span>(balance);  </span><br><span class="line">    &#125;  </span><br><span class="line">    writeCheck(debit: number) &#123;  </span><br><span class="line">        <span class="keyword">this</span>.balance -= debit;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>生成的核心代码： In the emitted JavaScript code, the prototype of ‘CheckingAccount’ will chain to the prototype of ‘BankAccount’.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">__extends(CheckingAccount, _super);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> __extends = (<span class="keyword">this</span> &amp;&amp; <span class="keyword">this</span>.__extends) || <span class="function"><span class="keyword">function</span>(<span class="params">d, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> p <span class="keyword">in</span> b)</span><br><span class="line">        <span class="keyword">if</span> (b.hasOwnProperty(p)) d[p] = b[p];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__</span>(<span class="params"></span>) </span>&#123; <span class="keyword">this</span>.constructor = d; &#125;</span><br><span class="line">    d.prototype = b === <span class="literal">null</span> ? <span class="built_in">Object</span>.create(b) : (__.prototype = b.prototype, <span class="keyword">new</span> __());</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>更多：</p>
<p>Since instance member variable initializers are equivalent to assignments to properties of this in the constructor, the example</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;  </span><br><span class="line">    public name: string;  </span><br><span class="line">    public address: string;  </span><br><span class="line">    public retired = <span class="literal">false</span>;  </span><br><span class="line">    public manager: Employee = <span class="literal">null</span>;  </span><br><span class="line">    public reports: Employee[] = [];  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>等价：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;  </span><br><span class="line">    public name: string;  </span><br><span class="line">    public address: string;  </span><br><span class="line">    public retired: boolean;  </span><br><span class="line">    public manager: Employee;  </span><br><span class="line">    public reports: Employee[];  </span><br><span class="line">    constructor() &#123;  </span><br><span class="line">        <span class="keyword">this</span>.retired = <span class="literal">false</span>;  </span><br><span class="line">        <span class="keyword">this</span>.manager = <span class="literal">null</span>;  </span><br><span class="line">        <span class="keyword">this</span>.reports = [];  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更多的见 <a href="https://github.com/Microsoft/TypeScript/blob/master/doc/spec.md#8" target="_blank" rel="external">Classes</a></p>
<p>namespace：</p>
<h2 id="1-10_Namespaces"><a href="#1-10_Namespaces" class="headerlink" title="1.10 Namespaces"></a>1.10 Namespaces</h2><p>产生背景：</p>
<p>TypeScript enforces encapsulation of implementation in classes at design time (by restricting use of private and protected members), but cannot enforce encapsulation at runtime because all object properties are accessible at runtime. </p>
<p>JavaScript 怎么做到：</p>
<p>In JavaScript, a very common way to enforce encapsulation at runtime is to use the module pattern: encapsulate private fields and methods using closure variables.</p>
<p>其他好处：</p>
<p>The module pattern can also provide the ability to introduce namespaces, avoiding use of the global namespace for most software components.</p>
<p>在 JavaScript 是这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">exports</span>) </span>&#123;  </span><br><span class="line">    <span class="keyword">var</span> key = generateSecretKey();  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">sendMessage</span>(<span class="params">message</span>) </span>&#123;  </span><br><span class="line">        sendSecureMessage(message, key);  </span><br><span class="line">    &#125;  </span><br><span class="line">    exports.sendMessage = sendMessage;  </span><br><span class="line">&#125;)(MessageModule);</span><br></pre></td></tr></table></figure>
<p>在 TypeScript 这么做 </p>
<p>TypeScript namespaces provide a mechanism for succinctly expressing the module pattern. In TypeScript, programmers can combine the module pattern with the class pattern by nesting namespaces and classes within an outer namespace.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">namespace M &#123;  </span><br><span class="line">    <span class="keyword">var</span> s = <span class="string">"hello"</span>;  </span><br><span class="line">    <span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> s;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">M.f();  </span><br><span class="line">M.s;  <span class="comment">// Error, s is not exported</span></span><br></pre></td></tr></table></figure>
</div></article></div></section><footer><div class="paginator"><a href="/2016/02/26/TypeScript-Spec-Version-1-8-Other/" class="prev">上一篇</a><a href="/2016/02/26/TypeScript-Spec-Version-1-8/" class="next">下一篇</a></div></footer><script src="https://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>