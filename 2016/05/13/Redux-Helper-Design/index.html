<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Redux Helper Design · Shane Hsi Rocks</title><meta name="description" content="目前的设计, actions: 
12345678910111213141516&lt;span cla"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">博客</a></li><li class="nav-list-item"><a href="https://github.com/shane13hsi" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Redux Helper Design</h1><div class="post-meta"><div class="post-time">May 13, 2016</div></div><div class="post-content"><p>目前的设计, actions: </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">ActionFactory</span> </span>&#123;</span><br><span class="line">  protected namespace: any</span><br><span class="line">  protected defaultActions: any</span><br><span class="line"></span><br><span class="line">  constructor(ns) &#123;</span><br><span class="line">    <span class="keyword">this</span>.namespace = ns</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  createAction(type, payload?) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      type: <span class="string">`<span class="subst">$&#123;this.namespace&#125;</span>/<span class="subst">$&#123;type&#125;</span>`</span>,</span><br><span class="line">      payload,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  actions() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.defaultActions</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>就是调用了 createAction 这个方法. </p>
<p>现在有一个问题是, OO 的设计模式如何体现.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> _ <span class="keyword">from</span> <span class="string">'lodash'</span></span><br><span class="line"><span class="keyword">import</span> ActionFactory <span class="keyword">from</span> <span class="string">'./ActionFactory'</span></span><br><span class="line"></span><br><span class="line">export default class CommonActionFactory extends ActionFactory &#123;</span><br><span class="line">  constructor(ns) &#123;</span><br><span class="line">    super(ns)</span><br><span class="line">    this.defaultActions = &#123;</span><br><span class="line">      set: (path, value) =&gt; &#123;</span><br><span class="line">        return this.createAction(<span class="string">'set'</span>, &#123;path, value&#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      openModal: (key) =&gt; &#123;</span><br><span class="line">        return this.createAction(<span class="string">'openModal'</span>, &#123;key&#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      closeModal: (key) =&gt; &#123;</span><br><span class="line">        return this.createAction(<span class="string">'closeModal'</span>, &#123;key&#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      start: (key) =&gt; &#123;</span><br><span class="line">        return this.createAction(<span class="string">'start'</span>, &#123;key&#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      end: (key) =&gt; &#123;</span><br><span class="line">        return this.createAction(<span class="string">'end'</span>, &#123;key&#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  static isShow = function (state, key) &#123;</span><br><span class="line">    return _.get(state, [<span class="string">'view'</span>, <span class="string">'showModal'</span>, key])</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  static isPending = function (state, key) &#123;</span><br><span class="line">    return _.get(state, [<span class="string">'view'</span>, <span class="string">'pending'</span>, key])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于 Form</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ActionFactory <span class="keyword">from</span> <span class="string">'./ActionFactory'</span></span><br><span class="line"></span><br><span class="line">export default class FormActionFactory extends ActionFactory &#123;</span><br><span class="line">  constructor(ns) &#123;</span><br><span class="line">    super(ns)</span><br><span class="line">    this.defaultActions = &#123;</span><br><span class="line">      setField: (path, value) =&gt; &#123;</span><br><span class="line">        return this.createAction(<span class="string">'setField'</span>, &#123;path, value&#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      reset: (path, value) =&gt; &#123;</span><br><span class="line">        return this.createAction(<span class="string">'reset'</span>, &#123;path, value&#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      resetError: (path, value) =&gt; &#123;</span><br><span class="line">        return this.createAction(<span class="string">'resetError'</span>, &#123;path, value&#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      setError: (path, value) =&gt; &#123;</span><br><span class="line">        return this.createAction(<span class="string">'setError'</span>, &#123;path, value&#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      setPending: (path, value) =&gt; &#123;</span><br><span class="line">        return this.createAction(<span class="string">'setPending'</span>, &#123;path, value&#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于 ReducerFactory:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> _ <span class="keyword">from</span> <span class="string">'lodash'</span></span><br><span class="line"></span><br><span class="line">export default class ReducerFactory &#123;</span><br><span class="line">  protected namespace: any</span><br><span class="line">  protected defaultHandlers: any = &#123;&#125;</span><br><span class="line">  protected handlers: any = &#123;&#125;</span><br><span class="line">  protected initialState: any = &#123;&#125;</span><br><span class="line"></span><br><span class="line">  constructor(ns) &#123;</span><br><span class="line">    this.namespace = ns</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setInitialState(initialState) &#123;</span><br><span class="line">    this.initialState = _.merge(&#123;&#125;, this.initialState, initialState)</span><br><span class="line">    return this</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setHandlers(handlers) &#123;</span><br><span class="line">    this.handlers = handlers</span><br><span class="line">    return this</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getReducer() &#123;</span><br><span class="line">    const finalHandlers = _.merge(&#123;&#125;, this.defaultHandlers, this.handlers)</span><br><span class="line"></span><br><span class="line">    return (state, action) =&gt; &#123;</span><br><span class="line">      if (!Boolean(state)) &#123;</span><br><span class="line">        state = this.initialState</span><br><span class="line">      &#125;</span><br><span class="line">      if (finalHandlers.hasOwnProperty(action.type)) &#123;</span><br><span class="line">        return finalHandlers[action.type](state, action)</span><br><span class="line">      &#125;</span><br><span class="line">      return state</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后子类:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> _ <span class="keyword">from</span> <span class="string">'lodash'</span></span><br><span class="line"><span class="keyword">import</span> ReducerFactory <span class="keyword">from</span> <span class="string">'./ReducerFactory'</span></span><br><span class="line">const update = require(<span class="string">'./update'</span>)</span><br><span class="line"></span><br><span class="line">export default class FormReducerFactory extends ReducerFactory &#123;</span><br><span class="line">  constructor(ns) &#123;</span><br><span class="line">    super(ns)</span><br><span class="line"></span><br><span class="line">    this.setInitialState(&#123;</span><br><span class="line">      view: &#123;&#125;,</span><br><span class="line">      form: &#123;&#125;,</span><br><span class="line">      model: &#123;&#125;,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    this.defaultHandlers = &#123;</span><br><span class="line">      [`$&#123;<span class="keyword">this</span>.namespace&#125;/setField<span class="string">`]: (state, action) =&gt; &#123;</span><br><span class="line">        return _.set(_.merge(&#123;&#125;, state), ['form'].concat(action.payload.path), action.payload.value)</span><br><span class="line">      &#125;,</span><br><span class="line">      [`</span>$&#123;<span class="keyword">this</span>.namespace&#125;/reset<span class="string">`]: (state, action) =&gt; &#123;</span><br><span class="line">        return update(state, &#123;</span><br><span class="line">          form: &#123;$set: state.model&#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      [`</span>$&#123;<span class="keyword">this</span>.namespace&#125;/resetError<span class="string">`]: (state, action) =&gt; &#123;</span><br><span class="line">        return update(state, &#123;</span><br><span class="line">          validate: &#123;$set: &#123;&#125;&#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      [`</span>$&#123;<span class="keyword">this</span>.namespace&#125;/setError<span class="string">`]: (state, action) =&gt; &#123;</span><br><span class="line">        return _.set(_.merge(&#123;&#125;, state), `</span>validate.$&#123;action.payload.path&#125;<span class="string">`, action.payload.value)</span><br><span class="line">      &#125;,</span><br><span class="line">      [`</span>$&#123;<span class="keyword">this</span>.namespace&#125;/setPending<span class="string">`]: (state, action) =&gt; &#123;</span><br><span class="line">        return _.set(_.merge(&#123;&#125;, state), `</span>field.$&#123;action.payload.path&#125;.pending<span class="string">`, action.payload.value)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>先来看下 Alt 的设计, 来获取下如何设计 API 的想法.</p>
<h2 id="u4E00_u4E9B_u57FA_u672C_u7684_u60F3_u6CD5"><a href="#u4E00_u4E9B_u57FA_u672C_u7684_u60F3_u6CD5" class="headerlink" title="一些基本的想法"></a>一些基本的想法</h2><p>Redux 的 atom store, Redux 的生态( HMR, 一些 dev tools)是必须利用的.</p>
<p>Redux 的本质也很简单, 一个回调函数的注册. </p>
<p>我想要做的, 只是让写法能更模块化.<br>这个底层暂时也不要改. 改了也不影响上层. </p>
<h2 id="Alt"><a href="#Alt" class="headerlink" title="Alt"></a>Alt</h2><p>Actions 暂时还是做吧. 但是 Actions 可以封装起来. 如何传给 Component 还是问题. 用 HOC ?</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.props.actions.doSomething</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">generateActions() <span class="comment">// 快速生成 actions</span></span><br></pre></td></tr></table></figure>
<p>还有一点, Actions 要能够对异步请求做一层封装, 不要每次都这么多代码.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">actions.async</span><br><span class="line">.setPendingKey(<span class="string">'loadBasicInfo'</span>)</span><br><span class="line">(<span class="keyword">async</span>.loadBasicInfo))</span><br><span class="line">.end()</span><br><span class="line">.fail()</span><br><span class="line"></span><br><span class="line">actins.isPending(<span class="string">'loadBasicInfo'</span>)</span><br></pre></td></tr></table></figure>
<p>而且要思考下, 什么情况下会 cancel 一个请求.</p>
<p>action 有一个 id.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">action.id</span><br></pre></td></tr></table></figure>
<h3 id="Store"><a href="#Store" class="headerlink" title="Store"></a>Store</h3><p>也就是我想给 Reducer 加的</p>
<p>这里面就有一个神奇的(pull way)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyStore</span> </span>&#123;</span><br><span class="line">  constructor() &#123;</span><br><span class="line">    <span class="keyword">this</span>.bindAction(MyActions.FOO, <span class="keyword">this</span>.handleFoo);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleFoo(data) &#123;</span><br><span class="line">    <span class="comment">// do something with data</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyStore</span> </span>&#123;</span><br><span class="line">  constructor() &#123;</span><br><span class="line">    <span class="keyword">this</span>.bindActions(MyActions);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onFoo(data) &#123;</span><br><span class="line">    <span class="comment">// do something with data</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>它还能反过来(push way):</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyStore</span> </span>&#123;</span><br><span class="line">  constructor() &#123;</span><br><span class="line">    <span class="keyword">this</span>.bindListeners(&#123;</span><br><span class="line">      handleFoo: MyActions.FOO,</span><br><span class="line">      handleBar: [MyActions.BAR, OtherActions.BAR]</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleFoo(data) &#123;</span><br><span class="line">    <span class="comment">// will only be called by MyActions.foo()</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleBar(data) &#123;</span><br><span class="line">    <span class="comment">// will be called by MyActions.bar() and OtherActions.bar()</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>并且它也封装了 <code>update</code>, 当然它在 alt 中, 主要作用是 emit change</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyStore</span> </span>&#123;</span><br><span class="line">  handleFoo() &#123;</span><br><span class="line">    <span class="keyword">this</span>.state = &#123; foo: <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      <span class="comment">// set foo to 1 and emit a change.</span></span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        foo: <span class="number">1</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// supress emitting a change.</span></span><br><span class="line">    <span class="keyword">this</span>.preventDefault();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>来看下 Alt 对 Data Sources 的处理:</p>
<p>它的 API 设计:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>我觉得要给值做一个 box:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.props.xxx.isLoading</span><br><span class="line"></span><br><span class="line">value([xx,xx,xx])</span><br><span class="line">get([<span class="string">'xx'</span>,xx,xx]).value</span><br><span class="line">get([<span class="string">'xx'</span>,xx,xx]).loading</span><br><span class="line"></span><br><span class="line">&#123;$loading, $error, $expire, value: xx&#125;</span><br></pre></td></tr></table></figure>
<p>这个我们可以设置几个 box, 只有 box 才有 meta data. 比如缓存, 只有在这个级别可以做 $expire.</p>
<p>首次加载, 首次加载的时机, 可以在 route 时候做. 或者监听 quick click 事件 之类的. 这个时候感觉必须用 observable 做, 或者 event emitter.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.model.firstLoad()</span><br></pre></td></tr></table></figure>
<p> 其他的异步:</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> actions.async</span><br><span class="line">.setPendingKey(<span class="string">'loadBasicInfo'</span>)</span><br><span class="line">.setAction(<span class="keyword">async</span>.loadBasicInfo))</span><br><span class="line">.end()</span><br><span class="line">.fail()</span><br></pre></td></tr></table></figure>
<p> 大概打开了一些思路, 准备看看 react-redux-form</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 其中 alt 自动绑定了 store</span></span><br><span class="line"></span><br><span class="line">@alt.createActions()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FormActions</span> <span class="keyword">extends</span> <span class="title">Actions</span> </span>&#123;</span><br><span class="line">    constuctor() &#123;</span><br><span class="line">        <span class="keyword">this</span>.generateActions([<span class="string">'xx'</span>, <span class="string">'xx'</span>, <span class="string">'xx'</span>])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    updateTodo(id, text) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; id, text &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">FormActions.get(<span class="string">'xx'</span>) <span class="comment">// 不依赖动态特性</span></span><br><span class="line">FormActions.updateTodo()</span><br></pre></td></tr></table></figure>
<p>需要研究下 RelayContainer 是如何处理异步的.</p>
<p>可能一个思路:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@alt.createActions()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FormActions</span> <span class="keyword">extends</span> <span class="title">Actions</span> </span>&#123;</span><br><span class="line">    constuctor() &#123;</span><br><span class="line">        <span class="keyword">this</span>.generateActions([<span class="string">'xx'</span>, <span class="string">'xx'</span>, <span class="string">'xx'</span>])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    updateTodo(id, text) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; id, text &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@formActions(<span class="string">'xx'</span>)</span><br><span class="line"></span><br><span class="line">@compose(connect(state =&gt; state.xx), [commonActions, formActions])</span><br></pre></td></tr></table></figure>
<h2 id="u9996_u6B21_u52A0_u8F7D_u6570_u636E_u7684_u65B9_u5F0F"><a href="#u9996_u6B21_u52A0_u8F7D_u6570_u636E_u7684_u65B9_u5F0F" class="headerlink" title="首次加载数据的方式"></a>首次加载数据的方式</h2><p>暂时适用 componetDidMount 无所谓</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// box data</span></span><br><span class="line">basicInfo: &#123;</span><br><span class="line">    value: &#123;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    $expire: <span class="literal">true</span>, <span class="comment">// -1 代表还没有初始化</span></span><br><span class="line">    $pending: <span class="literal">false</span>,</span><br><span class="line">    $showPending: 计算属性: 不需要 expire 就不显示, 否则就再判断下 $pending</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很想改写下 <code>get</code>, <code>set</code> 这些 property descriptor.</p>
<h2 id="u770B_u4E0B"><a href="#u770B_u4E0B" class="headerlink" title="看下"></a>看下</h2><h2 id="u7B80_u5355_u770B_u4E0B_OO_Design_Pattern"><a href="#u7B80_u5355_u770B_u4E0B_OO_Design_Pattern" class="headerlink" title="简单看下 OO Design Pattern"></a>简单看下 OO Design Pattern</h2></div></article></div></section><footer><div class="paginator"><a href="/2016/05/13/Learn-API-of-react-redux-form/" class="prev">上一篇</a><a href="/2016/05/06/Umbrella-Externalize-the-State-Tree-or-alternatives/" class="next">下一篇</a></div></footer><script src="https://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>