<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Wallaby.js TypeScript Node Browser · Shane Hsi Rocks</title><meta name="description" content="结合 webpack 的用到了 wallaby-webpack postprocessor 和 TypeScript。
package.json
1234567&quot;devDependencies&quot;: &amp;#123;&lt;/sp"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">博客</a></li><li class="nav-list-item"><a href="https://github.com/shane13hsi" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Wallaby.js TypeScript Node Browser</h1><div class="post-meta"><div class="post-time">Apr 16, 2016</div></div><div class="post-content"><h2 id="u7ED3_u5408_webpack__u7684"><a href="#u7ED3_u5408_webpack__u7684" class="headerlink" title="结合 webpack 的"></a>结合 webpack 的</h2><p>用到了 wallaby-webpack postprocessor 和 TypeScript。</p>
<p>package.json</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"chai"</span>: <span class="string">"^2.1.2"</span>,</span><br><span class="line">    <span class="string">"wallaby-webpack"</span>: <span class="string">"*"</span>,</span><br><span class="line">    <span class="string">"webpack"</span>: <span class="string">"^1.7.3"</span>,</span><br><span class="line">    <span class="string">"ts-loader"</span>: <span class="string">"^0.5.5"</span>,</span><br><span class="line">    <span class="string">"typescript"</span>: <span class="string">"*"</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>tsconfig.json</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"compilerOptions"</span>: &#123;</span><br><span class="line">    <span class="string">"module"</span>: <span class="string">"commonjs"</span>,</span><br><span class="line">    <span class="string">"target"</span>: <span class="string">"es5"</span>,</span><br><span class="line">    <span class="string">"noEmit"</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"exclude"</span>: [</span><br><span class="line">    <span class="string">"node_modules"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"files"</span>: [</span><br><span class="line">    <span class="string">"typings/tsd.d.ts"</span>,</span><br><span class="line">    <span class="string">"typings/assertion-error/assertion-error.d.ts"</span>,</span><br><span class="line">    <span class="string">"typings/chai/chai.d.ts"</span>,</span><br><span class="line">    <span class="string">"typings/jasmine/jasmine.d.ts"</span>,</span><br><span class="line">    <span class="string">"typings/node/node.d.ts"</span>,</span><br><span class="line">    <span class="string">"test/personSpec.ts"</span>,</span><br><span class="line">    <span class="string">"src/Person.ts"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>wallaby.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> wallabyWebpack = <span class="built_in">require</span>(<span class="string">'wallaby-webpack'</span>);</span><br><span class="line"><span class="keyword">var</span> webpackPostprocessor = wallabyWebpack(&#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    files: [</span><br><span class="line">      <span class="comment">// load 为 false，是因为用到了 webpack。</span></span><br><span class="line">      &#123; pattern: <span class="string">'src/**/*.ts'</span>, load: <span class="literal">false</span> &#125;</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    tests: [</span><br><span class="line">      &#123; pattern: <span class="string">'test/**/*Spec.ts'</span>, load: <span class="literal">false</span> &#125;</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 结合 webpack</span></span><br><span class="line">    postprocessor: webpackPostprocessor,</span><br><span class="line"></span><br><span class="line">    bootstrap: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// required to trigger test loading</span></span><br><span class="line">      <span class="built_in">window</span>.__moduleBundler.loadTests();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="u7EAF_TypeScript"><a href="#u7EAF_TypeScript" class="headerlink" title="纯 TypeScript"></a>纯 TypeScript</h2><p>安装下 jasmine 的 typings</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">w</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    files: [</span><br><span class="line">      <span class="string">'src/*Browser.ts'</span></span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    tests: [</span><br><span class="line">      <span class="string">'test/*BrowserSpec.ts'</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>然后是这么引用 Jasmine 的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///&lt;reference path="../typings/jasmine/jasmine.d.ts"/&gt;</span></span><br><span class="line"><span class="comment">///&lt;reference path="../src/sayingsBrowser.ts"/&gt;</span></span><br><span class="line"></span><br><span class="line">describe(<span class="string">'Sayings Greeter'</span>, () =&gt; &#123;</span><br><span class="line">    it(<span class="string">'should greet'</span>, () =&gt; &#123;</span><br><span class="line">        <span class="keyword">var</span> greeter = <span class="keyword">new</span> Sayings.Greeter(<span class="string">'John'</span>);</span><br><span class="line">        expect(greeter.greet()).toBe(<span class="string">'Hello, John'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>纯的 TypeScript。基本没啥这么写的。要么就用 webpack 来写。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">w</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    files: [</span><br><span class="line">      <span class="string">'src/*Node.ts'</span></span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    tests: [</span><br><span class="line">      <span class="string">'test/*NodeSpec.ts'</span></span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    env: &#123;</span><br><span class="line">      type: <span class="string">'node'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// you may remove the setting if you have a tsconfig.json file where the same is set</span></span><br><span class="line">    compilers: &#123;</span><br><span class="line">      <span class="string">'**/*.ts'</span>: w.compilers.typeScript(&#123;<span class="built_in">module</span>: <span class="string">'commonjs'</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// By default TypeScript compiler renames .ts files to .js files.</span></span><br><span class="line">    <span class="comment">// If you'd like to not do it and for example use your own renaming strategy,</span></span><br><span class="line">    <span class="comment">// you may pass 'noRename' option to TS compiler</span></span><br><span class="line">    <span class="comment">//  '**/*.ts': w.compilers.typeScript(&#123; noRename: true &#125;)</span></span><br><span class="line">    <span class="comment">// and may use preprocessors to rename files the way you like:</span></span><br><span class="line">    <span class="comment">//preprocessors: &#123;</span></span><br><span class="line">    <span class="comment">//  '**/*.ts': file =&gt; file.rename(file.path + '.js').content</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</div></article></div></section><footer><div class="paginator"><a href="/2016/04/16/Wallaby-Summary/" class="prev">上一篇</a><a href="/2016/04/16/JavaScript-existential-operator-alternative-syntax/" class="next">下一篇</a></div></footer><script src="https://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>