<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Wallaby ES7 · Shane Hsi Rocks</title><meta name="description" content="先看看 package.json
12345678&amp;#123;  &quot;devDependencies&quot;: &amp;#123;    &quot;babel-core&quot;: &quot;^6.4.5&quot;,&lt;"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">博客</a></li><li class="nav-list-item"><a href="https://github.com/shane13hsi" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Wallaby ES7</h1><div class="post-meta"><div class="post-time">Apr 16, 2016</div></div><div class="post-content"><p>先看看 package.json</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"babel-core"</span>: <span class="string">"^6.4.5"</span>,</span><br><span class="line">    <span class="string">"babel-polyfill"</span>: <span class="string">"^6.3.14"</span>,</span><br><span class="line">    <span class="string">"babel-preset-es2015"</span>: <span class="string">"^6.3.13"</span>,</span><br><span class="line">    <span class="string">"babel-preset-stage-0"</span>: <span class="string">"^6.3.13"</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中 babel-polyfill 上次用到过，对于支持 async/await 必须：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"dependencies"</span>: &#123;</span><br><span class="line">  <span class="string">"core-js"</span>: <span class="string">"^2.1.0"</span>,</span><br><span class="line">  <span class="string">"babel-regenerator-runtime"</span>: <span class="string">"^6.3.13"</span>,</span><br><span class="line">  <span class="string">"babel-runtime"</span>: <span class="string">"^5.0.0"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/zloirock/core-js" target="_blank" rel="external">core-js</a> 是一个 polyfills 集合。</p>
<p>具体参见：<a href="https://babeljs.io/docs/usage/polyfill/" target="_blank" rel="external">Polyfill</a></p>
<p>babel-polyfill 和 regenerator-runtime 差别不大。具体差别参考上面的链接和源码。</p>
<p>在看下 <code>.babelrc</code> 配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"presets"</span>: [<span class="string">"es2015"</span>, <span class="string">"stage-0"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再看下 wallaby.js 配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">wallaby</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    files: [</span><br><span class="line">      &#123;pattern: <span class="string">'node_modules/babel-polyfill/dist/polyfill.js'</span>, instrument: <span class="literal">false</span>&#125;,</span><br><span class="line">      <span class="string">'src/**/*.js'</span></span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    tests: [</span><br><span class="line">      <span class="string">'test/**/*Spec.js'</span></span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    compilers: &#123;</span><br><span class="line">      <span class="string">'**/*.js'</span>: wallaby.compilers.babel()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>其中加入这句话，其中，<code>instrument</code> 为 <code>false</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;pattern: <span class="string">'node_modules/babel-polyfill/dist/polyfill.js'</span>, instrument: <span class="literal">false</span>&#125;,</span><br></pre></td></tr></table></figure>
<p>链接 <a href="https://wallabyjs.com/docs/config/files.html" target="_blank" rel="external">Configuration file: Files and tests</a></p>
<p>关于 <code>instrument</code>：</p>
<blockquote>
<p>The instrument boolean property (<strong>true by default</strong>) determines whether the file is instrumented. Setting the property to false disables the file <strong>code coverage reporting</strong> and prevents the file changes from <strong>triggering automatic test execution</strong>. The setting should normally be set to false for libraries, utils and other rarely changing files. Using the setting makes wallaby.js run your code <strong>faster</strong>, as it doesn’t have to perform unnecessary work.</p>
</blockquote>
<p>还有一个是 <code>compilers</code>。链接 <a href="https://wallabyjs.com/docs/config/compilers.html" target="_blank" rel="external">Compilers</a></p>
<p>写到这，我觉得要把 Wallaby/Configuration file 从头到尾看一遍。</p>
<p>更新：已经看完了。</p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/04/16/Monorepo/" class="prev">上一篇</a><a href="/2016/04/16/Babel-Stage-x-Syntax/" class="next">下一篇</a></div></footer><script src="https://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>